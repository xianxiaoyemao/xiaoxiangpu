<?php
/**
 * Created by PhpStorm.
 * User: LENOVO
 * Date: 2020/10/5
 * Time: 22:06
 */
namespace app\admin\controller\product;

use app\common\controller\Backend;

class Goods extends Backend
{
    protected $categoryModel = null;

    public function initialize()
    {
        parent::initialize(); // TODO: Change the autogenerated stub
        $this->categoryModel = new \app\admin\model\Category();
        $cate = $this->categoryModel->where('status', 1)->order('createtime', 'desc')->column('cate_name', 'id');
        $this->assign('category', $cate);
    }

    public function index ()
    {
        return $this-> fetch();
    }

    public function add(){
        if ($this->request->isPost()) {
            $params = $this->request->post('row/a');
            if($params){
                $data['username'] = $params['username'];
                $data['salt'] = Random::alnum();
                $data['password'] = md5(md5($params['password']).$data['salt']);
                $data['email'] = $params['email'];
                $data['nickname'] = $params['nickname'];
                $data['status'] = $params['status'];
                $data['createtime'] = time();
                try {
                    validate('Admin.add')->check($data);
                } catch (\Exception $e) {
                    $this->error($e->getMessage());
                }
                $resultid = Db::name('admin')->insertGetId($data);
                $group['uid'] = $resultid;
                $group['group_id'] = $params['groupid'];
                Db::name('auth_group_access') -> insert($group);
                AdminLog::adminlog('添加管理员',$data);
                $this->success();
            }
            $this->error();
        }
        return $this-> fetch();
    }
}
